# Use to get consistent colors
set -g default-terminal screen-256color

# Use UTF8
# set status-utf8 on
# set utf8 on

setw -g mode-keys vi


# --- Experimental -------------------------------------------------------------
# Allows for faster key repetition
set -s escape-time 0


# --- General ------------------------------------------------------------------
set -g base-index 1
# set -g pane-base-index 1
set -g mouse on

# Automatically re-number windows
set -g renumber-windows on

set -g history-limit 10000

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on


# === Key Bindings =============================================================
# --- Prefixless ---------------------------------------------------------------
# Pane resizing
bind -n S-Up resize-pane -U
bind -n S-Down resize-pane -D
bind -n S-Left resize-pane -L
bind -n S-Right resize-pane -R

# Smart pane switching with awareness of vim splits - from Thoughtbot
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys 'C-\\') || tmux select-pane -l"


# --- Prefix bindings ----------------------------------------------------------
unbind C-b
set -g prefix C-s

bind C-s send-prefix

# bind-key -r Space next-layout

bind b break-pane -d

# Navigate a pane to target directory, <prefix>B to open a new session for dir.
bind B send-keys 'tat && exit' 'C-m'

bind c new-window -c '#{pane_current_path}'

bind f command-prompt -p "Join pane from (eg: 2.3 for w2p3):" "join-pane -s '%%'"

# Quickly view system & process info in htop
bind h split-window -h "htop"

# Quickly edit a file in my notes
bind j split-window -h -c ~/Dropbox/Notes "reattach-to-user-namespace $EDITOR +CtrlP"
# bind j split-window -h -c ~/Dropbox/Notes/vzaar "reattach-to-user-namespace $EDITOR scratchpad.md"

# Kill session, but stay in Tmux if there are other sessions.
bind k run-shell 'tmux switch-client -n \; kill-session -t "$(tmux display-message -p "#S")" || tmux kill-session'

bind K confirm-before -p "Kill-pane #P? (y/n)" kill-pane

# set to main-horizontal, 60% height for main pane
# bind m set-window-option main-pane-height 50\; select-layout main-horizontal
bind m split-window -h -c ~/Dropbox/Notes "reattach-to-user-namespace $EDITOR -S ~/.vim/sessions/meta"
bind M set-window-option main-pane-height 60\; select-layout main-horizontal

bind N command-prompt -p "new session:" "new -s '%%'"

bind r source-file ~/.tmux.conf \; display-message " ~/.tmux.conf reloaded"
bind s choose-tree
bind t command-prompt -p "Join pane to (eg: 2.3 for w2p3):" "join-pane -t '%%'"

bind v split-window -h "$EDITOR ~/Dropbox/Notes/vzaar/vzaar.md"

bind y setw synchronize-panes


# More intuitive keybindings for splitting and keeping current path
bind - split-window -v -c '#{pane_current_path}'
bind \ split-window -h -c '#{pane_current_path}'
bind | split-window -h -c '#{pane_current_path}'

# This never works
bind M-s display-message "Meta-s received!"

# Setup 'v' to begin selection and 'y' to yank as in Vim
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"
bind -t vi-copy H start-of-line
bind -t vi-copy L end-of-line

# Update default binding of `Enter` to also use copy-pipe
unbind -t vi-copy Enter
bind -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"


# --- Highlight Current Pane ---------------------------------------------------
set -g window-style 'bg=colour0'
set -g window-active-style 'bg=colour233'


# --- Status Bar ---------------------------------------------------------------
set -g status-justify left
set -g status-left-length 40

setw -g status-left "  #S  "
setw -g window-status-current-format " #{?window_zoomed_flag,♦ ,  }#W#{?window_zoomed_flag, ♦,  } "
setw -g window-status-format "#{?window_last_flag,[, }#{?window_zoomed_flag,♦ ,  }#W#{?window_zoomed_flag, ♦,  }#{?window_last_flag,], }"
setw -g status-right "#{?client_prefix,[ prefix ],} "


# --- term-based --------------------------------------------------------------
set -g status-bg colour0
set -g status-fg colour7

# Current window
setw -g window-status-current-fg colour0
setw -g window-status-current-bg colour2

setw -g status-left-fg colour2
setw -g status-left-bg colour0

setw -g status-right-fg colour8
setw -g status-right-bg colour0

set -g message-fg colour0
set -g message-bg colour2

set -g pane-border-bg colour0
set -g pane-active-border-bg colour0
set -g pane-border-fg colour8
set -g pane-active-border-fg colour2


# --- Jellybeans-like ---------------------------------------------------------
# set -g status-fg '#6c6c6c'
# set -g status-bg '#303030'

# # Current window
# setw -g window-status-current-fg '#303030'
# setw -g window-status-current-bg '#87ae5f'

# setw -g status-left-fg '#87ae5f'
# setw -g status-left-bg '#303030'

# setw -g status-right-fg '#9e9e9e'
# setw -g status-right-bg '#303030'

# set -g message-fg '#303030'
# set -g message-bg '#87ae5f'

# set -g pane-border-bg '#151515'
# set -g pane-active-border-bg '#151515'
# set -g pane-border-fg '#333333'
# set -g pane-active-border-fg '#87ae5f'


# -----------------------------------------------------------------------------
#   Reference
# -----------------------------------------------------------------------------
# Window Flags
# '#'  window activity flag
# '!'  window bell flag
# '~'  window silence flag
# '*'  current window flag
# '-'  last window flag
# 'Z'  window zoomed flag
# ' ' (a space):  no flags at all.
